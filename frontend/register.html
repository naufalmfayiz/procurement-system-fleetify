<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - Procurement System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .register-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        padding: 40px;
        width: 100%;
        max-width: 400px;
      }
      .register-card h2 {
        color: #333;
        margin-bottom: 30px;
        text-align: center;
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px;
        font-weight: 600;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
      }
    </style>
  </head>
  <body>
    <div class="register-card">
      <h2>üìù Register</h2>
      <div id="registerForm">
        <div class="mb-3">
          <label for="username" class="form-label">Username</label>
          <input
            type="text"
            class="form-control"
            id="username"
            placeholder="Enter username"
            autocomplete="off"
          />
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            id="password"
            placeholder="Enter password (min 6 chars)"
            autocomplete="off"
          />
        </div>
        <div class="mb-3">
          <label for="confirmPassword" class="form-label"
            >Confirm Password</label
          >
          <input
            type="password"
            class="form-control"
            id="confirmPassword"
            placeholder="Confirm password"
            autocomplete="off"
          />
        </div>
        <button type="button" class="btn btn-primary w-100" id="registerBtn">
          <span class="btn-text">Register</span>
          <span
            class="spinner-border spinner-border-sm d-none"
            role="status"
          ></span>
        </button>
      </div>
      <hr />
      <p class="text-center text-muted mb-0">
        Already have an account? <a href="index.html">Login here</a>
      </p>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script>
      $(document).ready(function () {
        // Configure toastr
        toastr.options = {
          closeButton: true,
          progressBar: true,
          positionClass: "toast-top-right",
          timeOut: 5000,
        };

        // Register button click handler
        $("#registerBtn").on("click", function (e) {
          e.preventDefault();
          e.stopPropagation();

          const username = $("#username").val().trim();
          const password = $("#password").val().trim();
          const confirmPassword = $("#confirmPassword").val().trim();

          if (!username || !password || !confirmPassword) {
            toastr.warning("Please fill in all fields");
            return;
          }

          if (password !== confirmPassword) {
            toastr.error("Passwords do not match");
            return;
          }

          if (password.length < 6) {
            toastr.warning("Password must be at least 6 characters");
            return;
          }

          // Show loading state
          const $btn = $("#registerBtn");
          $btn.prop("disabled", true);
          $btn.find(".btn-text").text("Registering...");
          $btn.find(".spinner-border").removeClass("d-none");

          // Make register request
          api
            .post("/auth/register", { username, password })
            .done(function (response) {
              if (response.success) {
                toastr.success("Registration successful! Please login.");
                setTimeout(function () {
                  window.location.href = "index.html";
                }, 1500);
              } else {
                toastr.error(response.message || "Registration failed");
              }
            })
            .fail(function (xhr) {
              const message =
                xhr.responseJSON?.message ||
                "Registration failed. Please try again.";
              toastr.error(message);
            })
            .always(function () {
              // Reset button state
              $btn.prop("disabled", false);
              $btn.find(".btn-text").text("Register");
              $btn.find(".spinner-border").addClass("d-none");
            });
          // No return false here
        });
      });
    </script>
  </body>
</html>
